
(in-package :edec)

(defmacro gen-chk-sig (place)
  `(list* ',place (cdr (ssig-sign ,place))))

(defun verify-chk-sig (chk-sig)
  (with-simple-restart (continue "Check remaining signatures")
    (assert (apply #'ssig-verify
                   (eval (car chk-sig))
                   (cdr chk-sig))
        ()
      "Data does not match signature: ~A" (car chk-sig)
      )))

;; -------------------------------------------------
(with-ed-curve :curve1174
  (unless (boundp '*my-pkey*)
    (multiple-value-bind (pkey shares)
        (gen-key-pair)
      (distribute-shares shares)
      (setf *my-pkey* pkey)))
  (assert (ed-pt= *my-pkey*
                  (ed-mul *ed-gen* *my-skey*))
      ))
;; ---------------------------------------------------
#|
(with-ed-curve :curve1174
  (let ((*print-readably* t))
    (pprint
     (loop for sym in '(*my-pkey*
                        *my-skey*
                        *curve1174*
                        *curve-E382*
                        *curve41417*
                        *curve-Ed448*
                        *curve-e521*
                        *curve-Ed3363*
                        #-:WINDOWS pbc::*pairing-fr449-params*
                        #-:WINDOWS pbc::*pairing-fr256-params*
                        #-:WINDOWS pbc::*pairing-fr255-params*
                        #-:WINDOWS pbc::*pairing-fr250-params*
                        #-:WINDOWS pbc::*pairing-fr248-params*
                        #-:WINDOWS pbc::*pairing-fr247-params*
                        #-:WINDOWS pbc::*pairing-fr256-params-old*
                        #-:WINDOWS pbc::*pairing-default-ar160-params*
                        core-crypto::*wordlist*)
           collect
           (eval `(gen-chk-sig ,sym))
           ))))
|#
#||#
(with-ed-curve :curve1174
  (dolist (sig 
           '((*MY-PKEY*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              334886798536200350381766311756874707671512869680311329545467679591071044476
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "245A44806A1F55958B5F23186E83B58C3EFC52DD6353AF7DB1DBA45F0888767C"))))
             (*MY-SKEY*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              418623597373577396424004452408512164988541967976764240613193405866661970894
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "C0A2CC201C3477FCD06F7CC7630A9921A159785DCDB9BE5977FA018CEE1B44F3"))))
             (*CURVE1174*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              61001279961831431362089721791856395321573287158188762723965723703461492170
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "7CE6DDF28DAEBD1B6817BC7511757DCC81BAB8F0036955D61A0C08B4FCA32FE2"))))
             (*CURVE-E382*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              98374982873334003138519341027337126637647595001728589854787877728933502587
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "B16329E9B254115AE8AAED4F60F9664FD8A5E1CD9AA15C16B073A3F30E24A49B"))))
             (*CURVE41417*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              631688775994753077971426353387693574934808881732534027540879512338494165908
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "F23C019BE2A986236A1D9F8FF7F121E7023409C61B235F7DBF4A0BBD6A9B76C2"))))
             (*CURVE-ED448*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              302523843747646529571963430984127893288897907515880096876094274285458200013
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "ECAC8518CCD9CA93EC4282D9CBB529D73B22BE6319B85657A5CC6D836FC0FFD2"))))
             (*CURVE-E521*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              695487333688072030180431973946585118410555990551589169316922367156786429219
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "BF3811553B94B4198A7F268886189D708C1CBE5C7EDBA19EB5CFF05DBC2884EE"))))
             (*CURVE-ED3363*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              416714708492978296864689680161130758933665978383110377464940340919381893738
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "9184EEF657CE252F7972416AD496F17F952576E1E5D79730767C1E3927C4E5A3"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR449-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              153784626889859193226582958709279265980796300927749374873403498387170166718
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "841DC02B50822EC14E72B701F1CC8E5F7B70A0EEF91DAEC6E6BF0F98745189D2"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR256-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              5764924832811491179188991973753895443793937331879890588915199025070126896
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "F4D3FC2EFED4CB67CBE2FAEC5110D4B579BDAF3B3E3F91D3D6044B93492B71E7"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR255-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              141670755787970918038170492277508571711493632757372661152800420976821300100
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "6532F2F537ABEDBA8B5F2C437291144EB6716501109BEAF5C7CC8EF46035DBCD"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR250-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              456375094126838981163459417137461032068918356663692673362034677267740014309
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "3E232C3EF8339B037EE17F7246834C199D373A9EB6F46E02BA50A359B273F387"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR248-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              79544127911391313075621555573985106045217066894195582111586587690162749812
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "C05570AE53E781C86982C58AB4E45E567CE5C255081CDEFB603C0941ED5A6753"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR247-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              222523445825164150300356355914011283200198628917992179127915978229316274610
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "D0EA3D097CF8DD548EAB597921F21BA1F619A297101B0B5F30EF50679A5F755A"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-FR256-PARAMS-OLD*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              15821865244937462976548311874017020926139887247240284981044915845491372076
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "1C84377D00AA6423B930AC548F2765750FF0B651EA2AA30D270DF507DCCF20CB"))))
             #-:WINDOWS
             (PBC-INTERFACE::*PAIRING-DEFAULT-AR160-PARAMS*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              256902783493030371793356494809549622319873266414722332734013414666972060145
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "8ACD1FCCC4F826366B060AFFA9658CED4CB2E4AC8D5D5FB53ABACC3CABF37906"))))
             (CORE-CRYPTO::*WORDLIST*
              #S(ECC-CMPR-PT :CX 3238706287253458695043697889970663825594649144648473593115026994751520435692)
              149704376564104371999178525495906526227755771271300767945897740681340528362
              #.(make-instance 'HASH:HASH/256 :val (bev-vec (hex "42DC6996F57B6842646A47256BD0A65AE24C9BD636245B870193C3821DA67130")))))
           )))
#||#
